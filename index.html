<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Game 1</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <script src="jquery.sortable.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="jquery.ui.touch-punch.min.js"></script>

    <script type="text/javascript">

      $(function() {
        $(".sortable").sortable({connectWith: ".connectedSortable"}).disableSelection();

        });

        $( function() {
          $( "ul.droptrue" ).sortable({
            connectWith: "ul"

          });
        });

        /*
        game has different pages
        page is an object
        var
          -trayList
          -targetTotal
            targetTotal takes x items from trayList and combines them
          -piggyBankList
            user drags items from trayList to add to targetTotal
        */


        //Difficulty Controls
        //# of Coins in tray
        //this CAN be randomized
        var trayNum = 7;
        //# of Coins used in Amount
        //this WILL be randomized
        var coinsUsed = 4;
        var difficulty = '';

        // // function setDiff(difficulty){
        // //
        // //   this.difficulty = difficulty;
        // //   if(difficulty == 'easy'){
        // //     //Set Difficulty for each setting
        // //     //Adjust # of coins in tray
        // //     //Adjust # of coins used
        // //   }
        // //   if(difficulty== 'medium'){
        // //
        // //   }
        // //   if(difficulty == 'hard'){
        // //
        // //   }
        //
        // }

        function getRand(min,max){
          var r = Math.floor((Math.random()* max)+ min);
          return r;
        }
        function getRandCoin(){
          var coinNum;

          coinNum = getRand(1,4);
          switch(coinNum){
            case 1:
              addCoinToTray('penny');
              break;
            case 2:
              addCoinToTray('nickel');
              break;
            case 3:
              addCoinToTray('dime');
              break;
            case 4:
              addCoinToTray('quarter');
              break;
          }
        }
        function addCoinToTray(coin) {
            var $coin = coin;
            $('.tray').append(`<img src="${$coin}">`);
        }


        /*
        //key//
        nickel.jpg
        dime.png
        quarter.png
        penny.png
        2 cent
        50 cent dollar
        */

        //Checks Items in Piggy Bank
        function check(item){

          //alert(item.attr('src'));
          var x = 0;
          coin = item.attr('src');
          switch(coin){
            case 'penny':
              x = .01;
              break;
            case 'nickel':
              x = .05;
              break;
            case 'dime':
              x = .10;
              break;
            case 'quarter':
              //alert('quarter');
              x = .25;
              break;
          }
          return x;
        }
        //Takes static trayNum and fills the tray
        function createTray(){
          if(difficulty == 'easy'){
            trayNum = 6;
          }
          if(difficulty == 'medium'){
            trayNum = 9;
          }
          if(difficulty == 'hard'){
            trayNum = 12;
          }
          var max = trayNum
          for(var i = 0; i<max; i++){
            getRandCoin();
          }
        }

        function setTarget(){
          target = 0;
          //sets target num by gathering all coins
          //inside the tray and storing them inside the array
          var trayList = new Array();
          $('#tray img').each(function(){
            //push each value into the ArrayList
            trayList.push(check($(this)));
          });
          //we could change coins used to be random
          // this is just a demo

          //Set curTrayNum because we will need
          //to decrement the trayNum on each iteration or rand might be OOB
          curTrayNum = trayNum;

          //Difficulty controls for coinsUsed to SetTarget
          if(difficulty == 'easy'){
            coinsUsed = getRand(1,3);
          }
          if(difficulty == 'medium'){
            coinsUsed = getRand(3,5);
          }
          if(difficulty == 'hard'){
            coinsUsed = getRand(4,9);
          }
          for(var i = 0; i<coinsUsed;i++){

            addedNum = trayList[getRand(0,curTrayNum)]
            target += addedNum;

            //Remove used value from ArrayList
            //This wont work in IE<9
            pos = trayList.indexOf(addedNum);
            if(~pos) trayList.splice(pos,1);
            curTrayNum--;
          }
          //Fix weird Javascript rounding
          //2 decimal places
          target = target.toFixed(2);
          $('.targetSpan').html(target);

        }
        $(document).on('click', '.checkBtn', function(){
          total = 0;
          //Loops thru each of the images in ul
          $('#piggyBank img').each(function(){


            //alert($(this).find('img').attr('src'));
            total += check($(this));
          });

          //Deal with javascript weird rounding
          //total = Math.round(total * 1000)/1000;
          total = total.toFixed(2);
          //Add data to the span
          $('.totalSpan').text("");
          $('.totalSpan').html(total);

          //Check win condition
          totSpan = parseFloat($('.totalSpan').html());
          tarSpan = parseFloat($('.targetSpan').html());
          //Test if parsing right amount
          // alert(tarSpan);
          // alert(totSpan);
          if(tarSpan == totSpan){
            alert("Correct");
            score = $('.scoreNum').text();
            score = parseInt(score);
            score++;
            $('.scoreNum').html(score.toString());
            createNewBoard();
          }
          else if($('.strikes').html() =="XX")
          {
            $('.strikes').append("X");
            gameOverScreen();
          }

          else
          {
            $('.strikes').append("X");
          }


        });
        function createNewBoard(){
          //Clear the card
          $('.totalSpan').html('');
          $('.targetSpan').html('');
          $('#piggyBank').html('');
          $('#tray').html('');
          //restart the game

          createTray();
          setTarget();
        }
        $(document).on('click', '.skipBtn', function(){
          createNewBoard();
        });

        function startTimer(duration, display) {
          var timer = duration, minutes, seconds;
          var gametime;
          var time = setInterval(function () {
              minutes = parseInt(timer / 60, 10);
              seconds = parseInt(timer % 60, 10);

              minutes = minutes < 10 ? "0" + minutes : minutes;
              seconds = seconds < 10 ? "0" + seconds : seconds;

              display.text(minutes + ":" + seconds);

              if (--timer < -1) {
                  //timer = duration;




              }
              if(timer < 0){

                clearInterval(time);
                $('#time').html('Game Over');


              }
              if($('#time').html() == "Game Over"){
                //alert('game over');
                gameOverScreen();

              }
            }, 1000);



        }
        function gameOverScreen(){
          $('.currentCard').html('<h1>GAME OVER</h1>');

        }


        $(document).on('click', '.start', function(){

            var twoMinutes = 60 * 2,
            display = $('#time');
            difficulty = $('.diff').val();
            startTimer(twoMinutes, display);
            createTray();
            setTarget();
            $('.start').attr('disabled','disabled');


        });
        // buildCard(){
        //   target = createElement('h1');
        //   targetSpan = createElement('span');
        //
        //   bankTitle = createElement('p');
        //
        //   banktray = createElement('ul');
        //
        //   trayTitle = createElement('p');
        //   tray = createElement('ul');
        //
        // }

    </script>
    <style media="screen">
      .sortable{
              list-style-type: none; margin: 0;
              float: left;
              margin-right: 10px;
              background: #eee;
              padding: 5px;
              width: 100%;}
      .sortable img{ margin: 3px 3px 3px 0; padding: 1px; float: left; width: 100px; height: 90px; font-size: 4em; text-align: center; }
      img{
        max-width: 100%;
        max-height: 90%;
      }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm">
          <button type="button" name="button" class="start">Start</button>
        </div>
        <div class="col-sm">
          <select class="diff" name="">
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="col-sm">
          <h1>Timer</h1>
          <h3 id="time"></h3>
        </div>
        <div class="col-sm">
          <h1>Score</h1>
          <h3 class="scoreNum">0</h3>

        </div>
        <div class="col-sm">
          <h1>Strikes</h1>
          <h3 class="strikes"></h3>
        </div>

      </div>
      <br>
      <br>
      <br>
      <div class="currentCard">


      <div class="row">
        <div class="col-lg">



          <h1><span class="devTool"> Total: $ <span class="totalSpan">0.00</span></span> Target: $<span class="targetSpan"></span></h1>

        </div>
      </div>
      <div class="row">
        <p>piggyBank</p>
        <div class="col-lg">
          <ul id="piggyBank" class="sortable connectedSortable droptrue piggyBank">
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-sm">
          <p>tray</p>
          <ul id="tray"class="tray sortable droptrue">

          </ul>

        </div>
      </div>
      <div class="row">
        <div class="col-sm">
          <button type="button" name="button" class="checkBtn">Check</button>
        </div>
        <div class="col-sm">
          <button type="button" name="button" class="skipBtn">Skip</button>

        </div>

      </div>
      </div>
    </div>
    <!-- <div class="container">
      <h1>Total: $<span class="totalSpan">0.00</span> Target: $<span class="targetSpan"></span></h1>
      <div class="row">



        <div class="col-sm">

        </div>
      </div>
      <div class="row">
        <p>piggyBank</p>
        <div class="col-lg">
          <ul id="piggyBank" class="sortable connectedSortable droptrue piggyBank">
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col-sm">

        </div>
      </div>
      <br><br><br><br><br><br><br>
      <div class="row">
        <div class="col-sm">
          <p>tray</p>
          <ul id="tray"class="tray sortable droptrue">

          </ul>
          <button type="button" name="button" class="checkBtn">Check</button>
        </div>
      </div>

    </div> -->
  </body>
</html>
